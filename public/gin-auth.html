<link rel="import" href="bower_components/polymer/polymer-element.html">
<link rel="import" href="bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="bower_components/iron-pages/iron-pages.html">
<link rel="import" href="bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="gin-shared-styles.html">

<dom-module id="gin-auth">

    <template>
        <style is="custom-style" include="iron-flex iron-flex-alignment gin-shared-styles">
            :host {
                display: block;
            }
            #dialog {
                border-radius: 2px;
            }
            input {
                margin: 8px 0;
                padding: 8px 0 7px;
            }
            #pager {
                padding: 8px 40px 4px;
            }
        </style>

        <paper-dialog id="dialog" on-iron-overlay-closed="emptyForm" with-backdrop>
            <iron-pages id="pager" attr-for-selected="data-route" selected="[[section]]">
                <div data-route="signup" class="vertical layout">
                    <h3>Signup</h3>
                    <input id="signup-email" type="text" size="35">
                    <input id="signup-password" type="text" size="35">
                    <div class="horizontal layout">
                        <div>Already a user?</div>&nbsp;
                        <a href="javascript:;" class="link" on-click="toggleView">Login</a>
                    </div>
                    <br>
                    <button on-click="submitSignup">Submit</button>
                </div>
                <div data-route="login" class="vertical layout">
                    <h3>Login</h3>
                    <input id="login-email" type="text" size="35">
                    <input id="login-password" type="text" size="35">
                    <div class="horizontal layout">
                        <div>Not a user yet?</div>&nbsp;
                        <a href="javascript:;" class="link" on-click="toggleView">Sign up</a>
                    </div>
                    <br>
                    <button on-click="submitLogin">Submit</button>
                </div>
            </iron-pages>
        </paper-dialog>

    </template>
    <script>

        class GinAuth extends Polymer.Element {
            static get is() { return 'gin-auth'; }
            static get properties() {
                return {
                    section: {
                        type: String,
                        value: 'login'
                    }
                }
            }
            constructor() {
                super();
            }
            open() {
                this.$.dialog.open();
            }
            close() {
                this.$.dialog.close();
            }
            submitSignup() {
                const emailElement = this.$['signup-email'];
                const passwordElement = this.$['signup-password'];
                this.dispatchEvent(
                    new CustomEvent('firebase-request', {
                        bubbles: true,
                        composed: true,
                        detail: {
                            type: 'signup',
                            email: emailElement.value,
                            password: passwordElement.value
                        }
                    })
                );
                this.emptyForm();
            }
            toggleView() {
                this.section = this.section === 'signup' ? 'login' : 'signup';
            }
            submitLogin() {
                const emailElement = this.$['login-email'];
                const passwordElement = this.$['login-password'];
                this.dispatchEvent(
                    new CustomEvent('firebase-request', {
                        bubbles: true,
                        composed: true,
                        detail: {
                            type: 'login',
                            email: emailElement.value,
                            password: passwordElement.value
                        }
                    })
                );
                this.emptyForm();
            }
            emptyForm() {
                [...this.shadowRoot.querySelectorAll('input')].forEach(el => el.value = null);
                this.section = 'login';
            }
        }
        customElements.define(GinAuth.is, GinAuth);
    </script>
</dom-module>